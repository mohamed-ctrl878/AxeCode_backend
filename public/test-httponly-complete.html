<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„ - HttpOnly Cookies Authentication</title>

    <!-- ÙƒÙˆØ¯ ØªØ´Ø®ÙŠØµÙŠ Ù…Ø¶Ù…ÙˆÙ† -->
    <script>
      console.log("JavaScript ÙŠØ¹Ù…Ù„!");
      window.addEventListener("load", function () {
        console.log("Ø§Ù„ØµÙØ­Ø© ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ø§ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„");
        const form = document.getElementById("loginForm");
        console.log("Ø§Ù„ÙÙˆØ±Ù…:", form);

        if (form) {
          console.log("ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ÙÙˆØ±Ù…ØŒ Ø¬Ø§Ø±ÙŠ Ø¥Ø¶Ø§ÙØ© event listener...");

          // Ø¥Ù†Ø´Ø§Ø¡ instance Ù…Ù† HttpOnlyAuth
          const auth = new window.HttpOnlyAuth("http://localhost:1338");

          form.onsubmit = async function (e) {
            alert("ØªÙ… Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - Ø§Ù„ÙƒÙˆØ¯ ÙŠØ¹Ù…Ù„!"); // Ø§Ø­Ø°ÙÙ‡Ø§ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒØ¯
            console.log("ØªÙ… Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„!");
            e.preventDefault();
            e.stopPropagation();

            const identifier = document.getElementById("identifier").value;
            const password = document.getElementById("password").value;
            const resultDiv = document.getElementById("loginResult");

            console.log("Ø¨ÙŠØ§Ù†Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:", { identifier, password });

            try {
              console.log("Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...");

              // Ø§Ø³ØªØ®Ø¯Ø§Ù… fetch Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„ØªØ´Ø®ÙŠØµ
              const response = await fetch(
                "http://localhost:1338/api/auth/login",
                {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify({ identifier, password }),
                  credentials: "include", // Ù…Ù‡Ù… Ù„Ù„Ù€ HttpOnly cookies
                }
              );

              console.log("Response status:", response.status);
              console.log("Response headers:", response.headers);

              const result = await response.json();
              console.log("Response data:", result);

              if (response.ok) {
                resultDiv.innerHTML = `
                  <div class="success">
                    ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!<br>
                    Ù…Ø±Ø­Ø¨Ø§Ù‹ ${result.user.username}<br>
                    JWT: ${result.jwt ? "ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡" : "ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯"}
                  </div>
                `;

                console.log("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­:", result.user.username);

                // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ÙˆÙ…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                await checkAuthStatus();
                await updateUserInfo();
              } else {
                throw new Error(result.error?.message || "ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
              }
            } catch (error) {
              console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:", error);
              resultDiv.innerHTML = `
                <div class="error">
                  ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ${error.message}
                </div>
              `;
            }

            return false;
          };
          console.log("ØªÙ… Ø¥Ø¶Ø§ÙØ© event listener Ø¨Ù†Ø¬Ø§Ø­");
        } else {
          console.error("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ÙÙˆØ±Ù…!");
          alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ÙÙˆØ±Ù…!");
        }
      });
    </script>

    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f8f9fa;
        direction: rtl;
      }
      .container {
        background: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      .form-group {
        margin-bottom: 20px;
      }
      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #333;
      }
      input,
      select,
      textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 6px;
        box-sizing: border-box;
        font-size: 14px;
      }
      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: #007bff;
      }
      button {
        background-color: #007bff;
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        margin-right: 10px;
        margin-bottom: 10px;
        font-size: 14px;
        font-weight: 600;
      }
      button:hover {
        background-color: #0056b3;
      }
      button.secondary {
        background-color: #6c757d;
      }
      button.secondary:hover {
        background-color: #545b62;
      }
      button.danger {
        background-color: #dc3545;
      }
      button.danger:hover {
        background-color: #c82333;
      }
      .success {
        color: #155724;
        background-color: #d4edda;
        padding: 15px;
        border-radius: 6px;
        margin: 15px 0;
        border: 1px solid #c3e6cb;
      }
      .error {
        color: #721c24;
        background-color: #f8d7da;
        padding: 15px;
        border-radius: 6px;
        margin: 15px 0;
        border: 1px solid #f5c6cb;
      }
      .info {
        color: #0c5460;
        background-color: #d1ecf1;
        padding: 15px;
        border-radius: 6px;
        margin: 15px 0;
        border: 1px solid #bee5eb;
      }
      .warning {
        color: #856404;
        background-color: #fff3cd;
        padding: 15px;
        border-radius: 6px;
        margin: 15px 0;
        border: 1px solid #ffeaa7;
      }
      pre {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        overflow-x: auto;
        border: 1px solid #e9ecef;
        font-size: 12px;
      }
      .grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }
      .status-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-left: 8px;
      }
      .status-authenticated {
        background-color: #28a745;
      }
      .status-not-authenticated {
        background-color: #dc3545;
      }
      .permission-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 10px;
        margin-top: 15px;
      }
      .permission-item {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        text-align: center;
      }
      .permission-granted {
        background-color: #d4edda;
        border-color: #c3e6cb;
      }
      .permission-denied {
        background-color: #f8d7da;
        border-color: #f5c6cb;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„ - HttpOnly Cookies Authentication</h1>

    <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© -->
    <div class="container">
      <h2>ğŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©</h2>
      <div id="authStatus" class="info">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©...</div>
      <button onclick="checkAuthStatus()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©</button>
    </div>

    <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div class="container">
      <h2>ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
      <form id="loginForm">
        <div class="form-group">
          <label for="identifier">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</label>
          <input type="text" id="identifier" name="identifier" required />
        </div>
        <div class="form-group">
          <label for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
          <input type="password" id="password" name="password" required />
        </div>
        <button type="submit">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      </form>
      <div id="loginResult"></div>
    </div>

    <!-- Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© -->
    <div class="grid">
      <div class="container">
        <h2>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©</h2>
        <button onclick="testAuth()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©</button>
        <button onclick="getProtectedData()">Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù…ÙŠØ©</button>
        <button onclick="refreshToken()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ Token</button>
        <div id="authTestResult"></div>
      </div>

      <div class="container">
        <h2>ğŸ”’ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</h2>
        <div class="form-group">
          <label for="permissionAction">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡:</label>
          <select id="permissionAction">
            <option value="create">Ø¥Ù†Ø´Ø§Ø¡</option>
            <option value="read">Ù‚Ø±Ø§Ø¡Ø©</option>
            <option value="update">ØªØ­Ø¯ÙŠØ«</option>
            <option value="delete">Ø­Ø°Ù</option>
          </select>
        </div>
        <div class="form-group">
          <label for="permissionSubject">Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹:</label>
          <select id="permissionSubject">
            <option value="api::product.product">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</option>
            <option value="api::course.course">Ø§Ù„Ø¯ÙˆØ±Ø§Øª</option>
            <option value="api::user.user">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</option>
          </select>
        </div>
        <button onclick="checkPermission()">ÙØ­Øµ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</button>
        <div id="permissionResult"></div>
      </div>
    </div>

    <!-- Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø¯ÙˆØ§Ø± -->
    <div class="container">
      <h2>ğŸ‘¥ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø¯ÙˆØ§Ø±</h2>
      <div class="form-group">
        <label for="roleName">Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±:</label>
        <select id="roleName">
          <option value="authenticated">Ù…Ø³ØªØ®Ø¯Ù… Ù…ØµØ§Ø¯Ù‚</option>
          <option value="admin">Ù…Ø¯ÙŠØ±</option>
          <option value="moderator">Ù…Ø´Ø±Ù</option>
          <option value="user">Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ø¯ÙŠ</option>
        </select>
      </div>
      <button onclick="checkRole()">ÙØ­Øµ Ø§Ù„Ø¯ÙˆØ±</button>
      <button onclick="testAdminOnly()">Ø§Ø®ØªØ¨Ø§Ø± Admin Only</button>
      <div id="roleResult"></div>
    </div>

    <!-- Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø© -->
    <div class="grid">
      <div class="container">
        <h2>âš¡ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©</h2>
        <button onclick="createProduct()">Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†ØªØ¬</button>
        <button onclick="updateProduct()">ØªØ­Ø¯ÙŠØ« Ù…Ù†ØªØ¬</button>
        <button onclick="testCodeExecution()">Ø§Ø®ØªØ¨Ø§Ø± ØªÙ†ÙÙŠØ° Ø§Ù„ÙƒÙˆØ¯</button>
        <div id="advancedTestResult"></div>
      </div>

      <div class="container">
        <h2>ğŸ” ÙØ­Øµ Ø§Ù„Ø£Ù…Ø§Ù†</h2>
        <button onclick="checkCookies()">ÙØ­Øµ Ø§Ù„Ù€ Cookies</button>
        <button onclick="testXSSProtection()">Ø§Ø®ØªØ¨Ø§Ø± Ø­Ù…Ø§ÙŠØ© XSS</button>
        <button onclick="testCSRFProtection()">Ø§Ø®ØªØ¨Ø§Ø± Ø­Ù…Ø§ÙŠØ© CSRF</button>
        <div id="securityTestResult"></div>
      </div>
    </div>

    <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ -->
    <div class="container">
      <h2>ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</h2>
      <button onclick="logout()" class="danger">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
      <div id="logoutResult"></div>
    </div>

    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
    <div class="container">
      <h2>ğŸ‘¤ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h2>
      <div id="userInfo" class="info">Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¹Ø¯</div>
    </div>

    <!-- Ø§Ù„Ø³Ø¬Ù„Ø§Øª -->
    <div class="container">
      <h2>ğŸ“ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</h2>
      <button onclick="clearLogs()" class="secondary">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</button>
      <div id="logs"></div>
    </div>

    <script src="/auth-utils.js"></script>
    <script>
      window.addEventListener("DOMContentLoaded", function () {
        // Ø¥Ù†Ø´Ø§Ø¡ instance Ù…Ù† HttpOnlyAuth
        const auth = new window.HttpOnlyAuth("http://localhost:1338");
        let logs = [];

        // Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¬Ù„Ø§Øª
        function addLog(message, type = "info") {
          const timestamp = new Date().toLocaleTimeString("ar-SA");
          logs.unshift(`[${timestamp}] ${message}`);
          updateLogsDisplay();
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
        function updateLogsDisplay() {
          const logsDiv = document.getElementById("logs");
          logsDiv.innerHTML = logs.map((log) => `<div>${log}</div>`).join("");
        }

        // Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
        function clearLogs() {
          logs = [];
          updateLogsDisplay();
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
        async function checkAuthStatus() {
          try {
            addLog("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©...");
            const isAuth = await auth.isAuthenticated();

            const statusDiv = document.getElementById("authStatus");
            if (isAuth) {
              const user = await auth.getCurrentUser();
              statusDiv.innerHTML = `
                        <div class="success">
                            <span class="status-indicator status-authenticated"></span>
                            <strong>Ù…ØµØ§Ø¯Ù‚ Ø¹Ù„ÙŠÙ‡</strong><br>
                            Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${user.username}<br>
                            Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: ${user.email}<br>
                            Ø§Ù„Ø¯ÙˆØ±: ${user.role?.type || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}
                        </div>
                    `;
              addLog("Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ØµØ§Ø¯Ù‚ Ø¹Ù„ÙŠÙ‡", "success");
            } else {
              statusDiv.innerHTML = `
                        <div class="error">
                            <span class="status-indicator status-not-authenticated"></span>
                            <strong>ØºÙŠØ± Ù…ØµØ§Ø¯Ù‚ Ø¹Ù„ÙŠÙ‡</strong><br>
                            ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                        </div>
                    `;
              addLog("Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ØµØ§Ø¯Ù‚ Ø¹Ù„ÙŠÙ‡", "error");
            }
          } catch (error) {
            addLog(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©: ${error.message}`, "error");
          }
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        document
          .getElementById("loginForm")
          .addEventListener("submit", async (e) => {
            e.preventDefault();

            const identifier = document.getElementById("identifier").value;
            const password = document.getElementById("password").value;
            const resultDiv = document.getElementById("loginResult");

            try {
              addLog("Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...");
              const result = await auth.login(identifier, password);

              resultDiv.innerHTML = `
                    <div class="success">
                        ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!<br>
                        Ù…Ø±Ø­Ø¨Ø§Ù‹ ${result.user.username}
                    </div>
                `;

              addLog(
                `ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­: ${result.user.username}`,
                "success"
              );

              // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ÙˆÙ…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
              await checkAuthStatus();
              await updateUserInfo();
            } catch (error) {
              resultDiv.innerHTML = `
                    <div class="error">
                        ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ${error.message}
                    </div>
                `;
              addLog(`ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ${error.message}`, "error");
            }
          });

        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
        async function testAuth() {
          try {
            addLog("Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©...");
            const result = await auth.authenticatedRequest(
              "/api/products/test-auth"
            );

            document.getElementById("authTestResult").innerHTML = `
                    <div class="success">
                        <h4>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ù†Ø§Ø¬Ø­!</h4>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                    </div>
                `;

            addLog("Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ù†Ø§Ø¬Ø­", "success");
          } catch (error) {
            document.getElementById("authTestResult").innerHTML = `
                    <div class="error">
                        ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©: ${error.message}
                    </div>
                `;
            addLog(`ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©: ${error.message}`, "error");
          }
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù…ÙŠØ©
        async function getProtectedData() {
          try {
            addLog("Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù…ÙŠØ©...");
            const result = await auth.authenticatedRequest(
              "/api/products/protected-data"
            );

            document.getElementById("authTestResult").innerHTML = `
                    <div class="success">
                        <h4>ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù…ÙŠØ©!</h4>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                    </div>
                `;

            addLog("ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù…ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­", "success");
          } catch (error) {
            document.getElementById("authTestResult").innerHTML = `
                    <div class="error">
                        ÙØ´Ù„ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù…ÙŠØ©: ${error.message}
                    </div>
                `;
            addLog(
              `ÙØ´Ù„ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù…ÙŠØ©: ${error.message}`,
              "error"
            );
          }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ token
        async function refreshToken() {
          try {
            addLog("Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ token...");
            const result = await auth.refreshToken();

            document.getElementById("authTestResult").innerHTML = `
                    <div class="success">
                        <h4>ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ token Ø¨Ù†Ø¬Ø§Ø­!</h4>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                    </div>
                `;

            addLog("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ token Ø¨Ù†Ø¬Ø§Ø­", "success");
          } catch (error) {
            document.getElementById("authTestResult").innerHTML = `
                    <div class="error">
                        ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ token: ${error.message}
                    </div>
                `;
            addLog(`ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ token: ${error.message}`, "error");
          }
        }

        // ÙØ­Øµ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
        async function checkPermission() {
          const action = document.getElementById("permissionAction").value;
          const subject = document.getElementById("permissionSubject").value;

          try {
            addLog(`Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©: ${action} Ø¹Ù„Ù‰ ${subject}...`);
            const hasPermission = await auth.checkPermission(action, subject);

            document.getElementById("permissionResult").innerHTML = `
                    <div class="${hasPermission ? "success" : "error"}">
                        <h4>Ù†ØªÙŠØ¬Ø© ÙØ­Øµ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</h4>
                        <p><strong>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡:</strong> ${action}</p>
                        <p><strong>Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹:</strong> ${subject}</p>
                        <p><strong>Ø§Ù„Ù†ØªÙŠØ¬Ø©:</strong> ${hasPermission ? "Ù…Ø³Ù…ÙˆØ­" : "ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­"}</p>
                    </div>
                `;

            addLog(
              `ØµÙ„Ø§Ø­ÙŠØ© ${action} Ø¹Ù„Ù‰ ${subject}: ${hasPermission ? "Ù…Ø³Ù…ÙˆØ­" : "ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­"}`,
              hasPermission ? "success" : "error"
            );
          } catch (error) {
            document.getElementById("permissionResult").innerHTML = `
                    <div class="error">
                        ÙØ´Ù„ ÙØ­Øµ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©: ${error.message}
                    </div>
                `;
            addLog(`ÙØ´Ù„ ÙØ­Øµ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©: ${error.message}`, "error");
          }
        }

        // ÙØ­Øµ Ø§Ù„Ø¯ÙˆØ±
        async function checkRole() {
          const roleName = document.getElementById("roleName").value;

          try {
            addLog(`Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ø¯ÙˆØ±: ${roleName}...`);
            const hasRole = await auth.checkRole(roleName);

            document.getElementById("roleResult").innerHTML = `
                    <div class="${hasRole ? "success" : "error"}">
                        <h4>Ù†ØªÙŠØ¬Ø© ÙØ­Øµ Ø§Ù„Ø¯ÙˆØ±</h4>
                        <p><strong>Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</strong> ${roleName}</p>
                        <p><strong>Ø§Ù„Ù†ØªÙŠØ¬Ø©:</strong> ${hasRole ? "ÙŠÙ…Ù„Ùƒ Ø§Ù„Ø¯ÙˆØ±" : "Ù„Ø§ ÙŠÙ…Ù„Ùƒ Ø§Ù„Ø¯ÙˆØ±"}</p>
                    </div>
                `;

            addLog(
              `Ø¯ÙˆØ± ${roleName}: ${hasRole ? "ÙŠÙ…Ù„Ùƒ Ø§Ù„Ø¯ÙˆØ±" : "Ù„Ø§ ÙŠÙ…Ù„Ùƒ Ø§Ù„Ø¯ÙˆØ±"}`,
              hasRole ? "success" : "error"
            );
          } catch (error) {
            document.getElementById("roleResult").innerHTML = `
                    <div class="error">
                        ÙØ´Ù„ ÙØ­Øµ Ø§Ù„Ø¯ÙˆØ±: ${error.message}
                    </div>
                `;
            addLog(`ÙØ´Ù„ ÙØ­Øµ Ø§Ù„Ø¯ÙˆØ±: ${error.message}`, "error");
          }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Admin Only
        async function testAdminOnly() {
          try {
            addLog("Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Admin Only...");
            const result = await auth.authenticatedRequest(
              "/api/products/admin-only"
            );

            document.getElementById("roleResult").innerHTML = `
                    <div class="success">
                        <h4>Ø§Ø®ØªØ¨Ø§Ø± Admin Only Ù†Ø§Ø¬Ø­!</h4>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                    </div>
                `;

            addLog("Ø§Ø®ØªØ¨Ø§Ø± Admin Only Ù†Ø§Ø¬Ø­", "success");
          } catch (error) {
            document.getElementById("roleResult").innerHTML = `
                    <div class="error">
                        ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± Admin Only: ${error.message}
                    </div>
                `;
            addLog(`ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± Admin Only: ${error.message}`, "error");
          }
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†ØªØ¬
        async function createProduct() {
          try {
            addLog("Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†ØªØ¬...");
            const productData = {
              name: "Ù…Ù†ØªØ¬ ØªØ¬Ø±ÙŠØ¨ÙŠ",
              description: "ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ",
              price: 99.99,
            };

            const result = await auth.authenticatedRequest(
              "/api/products/create-product",
              {
                method: "POST",
                body: JSON.stringify(productData),
              }
            );

            document.getElementById("advancedTestResult").innerHTML = `
                    <div class="success">
                        <h4>ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­!</h4>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                    </div>
                `;

            addLog("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­", "success");
          } catch (error) {
            document.getElementById("advancedTestResult").innerHTML = `
                    <div class="error">
                        ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù†ØªØ¬: ${error.message}
                    </div>
                `;
            addLog(`ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù†ØªØ¬: ${error.message}`, "error");
          }
        }

        // ØªØ­Ø¯ÙŠØ« Ù…Ù†ØªØ¬
        async function updateProduct() {
          try {
            addLog("Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ù…Ù†ØªØ¬...");
            const updateData = {
              name: "Ù…Ù†ØªØ¬ Ù…Ø­Ø¯Ø«",
              description: "ÙˆØµÙ Ù…Ø­Ø¯Ø« Ù„Ù„Ù…Ù†ØªØ¬",
            };

            const result = await auth.authenticatedRequest(
              "/api/products/update-product/1",
              {
                method: "PUT",
                body: JSON.stringify(updateData),
              }
            );

            document.getElementById("advancedTestResult").innerHTML = `
                    <div class="success">
                        <h4>ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­!</h4>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                    </div>
                `;

            addLog("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­", "success");
          } catch (error) {
            document.getElementById("advancedTestResult").innerHTML = `
                    <div class="error">
                        ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬: ${error.message}
                    </div>
                `;
            addLog(`ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬: ${error.message}`, "error");
          }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± ØªÙ†ÙÙŠØ° Ø§Ù„ÙƒÙˆØ¯
        async function testCodeExecution() {
          try {
            addLog("Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± ØªÙ†ÙÙŠØ° Ø§Ù„ÙƒÙˆØ¯...");
            const codeData = {
              language: "cpp",
              code: "int main() { return 42; }",
              testCases: [],
              functionName: "main",
              functionReturnType: "int",
              expected: [42],
            };

            const result = await auth.authenticatedRequest(
              "/api/code-execution",
              {
                method: "POST",
                body: JSON.stringify(codeData),
              }
            );

            document.getElementById("advancedTestResult").innerHTML = `
                    <div class="success">
                        <h4>ØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­!</h4>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                    </div>
                `;

            addLog("ØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­", "success");
          } catch (error) {
            document.getElementById("advancedTestResult").innerHTML = `
                    <div class="error">
                        ÙØ´Ù„ ØªÙ†ÙÙŠØ° Ø§Ù„ÙƒÙˆØ¯: ${error.message}
                    </div>
                `;
            addLog(`ÙØ´Ù„ ØªÙ†ÙÙŠØ° Ø§Ù„ÙƒÙˆØ¯: ${error.message}`, "error");
          }
        }

        // ÙØ­Øµ Ø§Ù„Ù€ Cookies
        function checkCookies() {
          addLog("Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ù€ Cookies...");

          const cookies = document.cookie;
          const jwtCookie = document.cookie
            .split(";")
            .find((c) => c.trim().startsWith("jwt="));

          let result = "";
          if (cookies) {
            result += `<p><strong>Ø§Ù„Ù€ Cookies Ø§Ù„Ù…Ø±Ø¦ÙŠØ©:</strong> ${cookies}</p>`;
          } else {
            result += `<p><strong>Ù„Ø§ ØªÙˆØ¬Ø¯ cookies Ù…Ø±Ø¦ÙŠØ©</strong></p>`;
          }

          if (jwtCookie) {
            result += `<p class="error"><strong>ØªØ­Ø°ÙŠØ±:</strong> JWT cookie Ù…Ø±Ø¦ÙŠ (Ù…Ø´ÙƒÙ„Ø© Ø£Ù…Ù†ÙŠØ©!)</p>`;
            addLog("JWT cookie Ù…Ø±Ø¦ÙŠ - Ù…Ø´ÙƒÙ„Ø© Ø£Ù…Ù†ÙŠØ©!", "error");
          } else {
            result += `<p class="success"><strong>Ù…Ù…ØªØ§Ø²:</strong> JWT cookie ØºÙŠØ± Ù…Ø±Ø¦ÙŠ (Ø¢Ù…Ù†!)</p>`;
            addLog("JWT cookie ØºÙŠØ± Ù…Ø±Ø¦ÙŠ - Ø¢Ù…Ù†!", "success");
          }

          document.getElementById("securityTestResult").innerHTML = `
                <div class="info">
                    <h4>Ù†ØªØ§Ø¦Ø¬ ÙØ­Øµ Ø§Ù„Ù€ Cookies</h4>
                    ${result}
                </div>
            `;
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø­Ù…Ø§ÙŠØ© XSS
        function testXSSProtection() {
          addLog("Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø­Ù…Ø§ÙŠØ© XSS...");

          try {
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ JWT cookie Ø¹Ø¨Ø± JavaScript
            const jwtCookie = document.cookie
              .split(";")
              .find((c) => c.trim().startsWith("jwt="));

            if (jwtCookie) {
              document.getElementById("securityTestResult").innerHTML = `
                        <div class="error">
                            <h4>Ø§Ø®ØªØ¨Ø§Ø± Ø­Ù…Ø§ÙŠØ© XSS</h4>
                            <p><strong>ØªØ­Ø°ÙŠØ±:</strong> ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ JWT cookie Ø¹Ø¨Ø± JavaScript</p>
                            <p>Ù‡Ø°Ø§ ÙŠØ´ÙƒÙ„ Ø®Ø·Ø± Ø£Ù…Ù†ÙŠ!</p>
                        </div>
                    `;
              addLog("ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø­Ù…Ø§ÙŠØ© XSS - JWT cookie Ù‚Ø§Ø¨Ù„ Ù„Ù„ÙˆØµÙˆÙ„", "error");
            } else {
              document.getElementById("securityTestResult").innerHTML = `
                        <div class="success">
                            <h4>Ø§Ø®ØªØ¨Ø§Ø± Ø­Ù…Ø§ÙŠØ© XSS</h4>
                            <p><strong>Ù…Ù…ØªØ§Ø²:</strong> Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ JWT cookie Ø¹Ø¨Ø± JavaScript</p>
                            <p>Ø­Ù…Ø§ÙŠØ© XSS ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­!</p>
                        </div>
                    `;
              addLog("Ø§Ø®ØªØ¨Ø§Ø± Ø­Ù…Ø§ÙŠØ© XSS Ù†Ø§Ø¬Ø­", "success");
            }
          } catch (error) {
            addLog(`Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± XSS: ${error.message}`, "error");
          }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø­Ù…Ø§ÙŠØ© CSRF
        function testCSRFProtection() {
          addLog("Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø­Ù…Ø§ÙŠØ© CSRF...");

          // ÙØ­Øµ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª SameSite
          const result = `
                <div class="info">
                    <h4>Ø§Ø®ØªØ¨Ø§Ø± Ø­Ù…Ø§ÙŠØ© CSRF</h4>
                    <p><strong>SameSite Cookie:</strong> ØªÙ… ØªØ¹ÙŠÙŠÙ†Ù‡ Ø¹Ù„Ù‰ "strict"</p>
                    <p><strong>HttpOnly:</strong> ØªÙ… ØªÙØ¹ÙŠÙ„Ù‡</p>
                    <p><strong>Ø§Ù„Ù†ØªÙŠØ¬Ø©:</strong> Ø­Ù…Ø§ÙŠØ© CSRF Ù…ÙØ¹Ù„Ø©</p>
                </div>
            `;

          document.getElementById("securityTestResult").innerHTML = result;
          addLog("Ø§Ø®ØªØ¨Ø§Ø± Ø­Ù…Ø§ÙŠØ© CSRF Ù†Ø§Ø¬Ø­", "success");
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        async function logout() {
          try {
            addLog("Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬...");
            const result = await auth.logout();

            document.getElementById("logoutResult").innerHTML = `
                    <div class="success">
                        ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­!
                    </div>
                `;

            addLog("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­", "success");

            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ÙˆÙ…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            await checkAuthStatus();
            await updateUserInfo();
          } catch (error) {
            document.getElementById("logoutResult").innerHTML = `
                    <div class="error">
                        ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬: ${error.message}
                    </div>
                `;
            addLog(`ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬: ${error.message}`, "error");
          }
        }

        // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        async function updateUserInfo() {
          try {
            const user = await auth.getCurrentUser();

            document.getElementById("userInfo").innerHTML = `
                    <div class="success">
                        <h4>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h4>
                        <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${user.username}</p>
                        <p><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</strong> ${user.email}</p>
                        <p><strong>Ø§Ù„Ø¯ÙˆØ±:</strong> ${user.role?.type || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</p>
                        <p><strong>Ù…Ø¤ÙƒØ¯:</strong> ${user.confirmed ? "Ù†Ø¹Ù…" : "Ù„Ø§"}</p>
                        <p><strong>Ù…Ø­Ø¸ÙˆØ±:</strong> ${user.blocked ? "Ù†Ø¹Ù…" : "Ù„Ø§"}</p>
                    </div>
                `;
          } catch (error) {
            document.getElementById("userInfo").innerHTML = `
                    <div class="error">
                        Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¹Ø¯
                    </div>
                `;
          }
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - Ø¥Ø¶Ø§ÙØ© event listener Ù„Ù„ÙÙˆØ±Ù…
        document
          .getElementById("loginForm")
          .addEventListener("submit", async (e) => {
            e.preventDefault(); // Ù…Ù†Ø¹ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©

            const identifier = document.getElementById("identifier").value;
            const password = document.getElementById("password").value;
            const resultDiv = document.getElementById("loginResult");

            try {
              addLog("Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...");
              const result = await auth.login(identifier, password);

              resultDiv.innerHTML = `
              <div class="success">
                ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!<br>
                Ù…Ø±Ø­Ø¨Ø§Ù‹ ${result.user.username}
              </div>
            `;

              addLog(
                `ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­: ${result.user.username}`,
                "success"
              );

              // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ÙˆÙ…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
              await checkAuthStatus();
              await updateUserInfo();
            } catch (error) {
              resultDiv.innerHTML = `
              <div class="error">
                ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ${error.message}
              </div>
            `;
              addLog(`ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ${error.message}`, "error");
            }
          });

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        (async () => {
          addLog("ØªÙ… ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±");
          await checkAuthStatus();
          await updateUserInfo();
        })();
      });
    </script>
  </body>
</html>
